--miramos la tabla 
SELECT* FROM pedido;

--creamos la tabla del TRIGGER
CREATE TABLE log_pedido (
num_pedido INTEGER,
preparar_para_llevar BOOLEAN,
num_mesa INTEGER,
Precio_total INTEGER,
DNI_MOZO INTEGER, 
Fecha DATE;

--Creamos la funcion a realizar
CREATE OR REPLACE FUNCTION tg_fun_log_pedido () RETURNS TRIGGER AS
$BODY$
DECLARE 
PRECIO INTEGER := (SELECT subtotal FROM producto_por_pedido PP WHERE PP.num_pedido = NEW.num_pedido);
BEGIN
    NEW.precio_total := NEW.num_pedido + num_pedido;
    RETURN NEW;
END
$BODY$
LANGUAGE plpgsql;


 
 CREATE OR REPLACE TRIGGER insert_pedido
    BEFORE INSERT
    ON pedido
    FOR EACH ROW
    EXECUTE PROCEDURE calcular_precio_total();

-----------------------------------------------------------------------------------

CREATE OR REPLACE FUNCTION calcular_precio_total()
    RETURNS trigger AS
$$
DECLARE
    sumTOTAL INTEGER := (SELECT SUM(subtotal) FROM productos_por_pedido P WHERE P.num_pedido = NEW.num_pedido);
BEGIN
    UPDATE pedido SET precio_total = sumTOTAL WHERE pedido.num_pedido = NEW.num_pedido ;
    RETURN NEW;
END;
$$
LANGUAGE plpgsql;
 
 CREATE OR REPLACE TRIGGER insert_pedido
    BEFORE INSERT
    ON pedido
    FOR EACH ROW
    EXECUTE PROCEDURE calcular_precio_total();